{%- liquid
  assign heading = section.settings.heading
  assign layout = section.settings.layout
-%}

<section class="collection-list collection-list--{{ layout }}" data-section-id="{{ section.id }}">
  <div class="container">
    {%- if heading != blank -%}
      <h2 class="collection-list__heading" data-animate>{{ heading }}</h2>
    {%- endif -%}

    <div class="collection-list__grid">
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = collections[block.settings.collection]
          assign image = block.settings.image | default: collection.image
          assign title = block.settings.title | default: collection.title
        -%}

        <div
          class="collection-list__item collection-list__item--{{ block.settings.size }}"
          {{ block.shopify_attributes }}
          data-animate
          data-animate-delay="{{ forloop.index | times: 100 }}"
        >
          <a href="{{ collection.url | default: '#' }}" class="collection-list__link">
            <div class="collection-list__media">
              {%- if block.settings.video != blank -%}
                {{ block.settings.video | video_tag:
                  autoplay: true,
                  loop: true,
                  muted: true,
                  playsinline: true,
                  class: 'collection-list__video'
                }}
              {%- elsif image != blank -%}
                {{ image | image_url: width: 1200 | image_tag:
                  class: 'collection-list__image',
                  loading: 'lazy',
                  widths: '400, 600, 800, 1000, 1200'
                }}
              {%- else -%}
                <div class="collection-list__placeholder">
                  {{ 'collection-' | append: forloop.index | placeholder_svg_tag }}
                </div>
              {%- endif -%}

              <div class="collection-list__overlay" style="--overlay-opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }}"></div>
            </div>

            <div class="collection-list__content" style="--text-color: {{ block.settings.text_color }}">
              {%- if block.settings.subtitle != blank -%}
                <span class="collection-list__subtitle">{{ block.settings.subtitle }}</span>
              {%- endif -%}
              {%- if title != blank -%}
                <h3 class="collection-list__title">{{ title }}</h3>
              {%- endif -%}
              {%- if block.settings.button_text != blank -%}
                <span class="collection-list__button">{{ block.settings.button_text }}</span>
              {%- endif -%}
            </div>
          </a>
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Collection list",
  "tag": "section",
  "class": "section-collection-list",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "masonry", "label": "Masonry" }
      ],
      "default": "masonry"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Custom image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video (optional)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Custom title"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "POGLEDAJ"
        },
        {
          "type": "select",
          "id": "size",
          "label": "Size",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ],
          "default": "medium"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#FFFFFF"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 70,
          "step": 5,
          "default": 20,
          "unit": "%",
          "label": "Overlay opacity"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection list",
      "blocks": [
        { "type": "collection", "settings": { "size": "large" } },
        { "type": "collection", "settings": { "size": "small" } },
        { "type": "collection", "settings": { "size": "small" } },
        { "type": "collection", "settings": { "size": "medium" } },
        { "type": "collection", "settings": { "size": "medium" } }
      ]
    }
  ]
}
{% endschema %}
