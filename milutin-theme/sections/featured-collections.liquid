{%- liquid
  assign heading = section.settings.heading
  assign columns = section.settings.columns
  assign aspect_ratio = section.settings.aspect_ratio
  assign text_alignment = section.settings.text_alignment
-%}

<section class="featured-collections" data-section-id="{{ section.id }}">
  <div class="container">
    {%- if heading != blank -%}
      <h2 class="featured-collections__heading" data-animate>{{ heading }}</h2>
    {%- endif -%}

    <div class="featured-collections__grid featured-collections__grid--{{ columns }}-col">
      {%- for block in section.blocks -%}
        {%- liquid
          assign collection = collections[block.settings.collection]
          assign image = block.settings.image | default: collection.image | default: collection.products.first.featured_image
          assign title = block.settings.title | default: collection.title
        -%}

        <div
          class="featured-collections__item"
          {{ block.shopify_attributes }}
          data-animate
          data-animate-delay="{{ forloop.index | times: 100 }}"
        >
          <a href="{{ collection.url | default: '#' }}" class="featured-collections__link">
            <div class="featured-collections__media featured-collections__media--{{ aspect_ratio }}">
              {%- if block.settings.video != blank -%}
                {{ block.settings.video | video_tag:
                  autoplay: true,
                  loop: true,
                  muted: true,
                  playsinline: true,
                  class: 'featured-collections__video'
                }}
              {%- elsif image != blank -%}
                {{ image | image_url: width: 800 | image_tag:
                  class: 'featured-collections__image',
                  loading: 'lazy',
                  widths: '300, 400, 500, 600, 800'
                }}
              {%- else -%}
                <div class="featured-collections__placeholder">
                  {{ 'collection-' | append: forloop.index | placeholder_svg_tag }}
                </div>
              {%- endif -%}

              <div class="featured-collections__overlay"></div>
            </div>

            <div class="featured-collections__content featured-collections__content--{{ text_alignment }}">
              {%- if title != blank -%}
                <h3 class="featured-collections__title">{{ title }}</h3>
              {%- endif -%}
              {%- if block.settings.subtitle != blank -%}
                <p class="featured-collections__subtitle">{{ block.settings.subtitle }}</p>
              {%- endif -%}
            </div>
          </a>
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Featured collections",
  "tag": "section",
  "class": "section-featured-collections",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Columns",
      "options": [
        { "value": "2", "label": "2 columns" },
        { "value": "3", "label": "3 columns" },
        { "value": "4", "label": "4 columns" }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "Image aspect ratio",
      "options": [
        { "value": "portrait", "label": "Portrait (3:4)" },
        { "value": "square", "label": "Square (1:1)" },
        { "value": "landscape", "label": "Landscape (4:3)" }
      ],
      "default": "portrait"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" }
      ],
      "default": "center"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Custom image",
          "info": "Overrides collection image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video (optional)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Custom title",
          "info": "Overrides collection title"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured collections",
      "blocks": [
        { "type": "collection" },
        { "type": "collection" },
        { "type": "collection" }
      ]
    }
  ]
}
{% endschema %}
