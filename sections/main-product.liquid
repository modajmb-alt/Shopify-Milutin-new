{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign featured_media = current_variant.featured_media | default: product.featured_media
  assign media_size = section.settings.media_size
  assign enable_sticky = section.settings.enable_sticky_info
  assign enable_zoom = section.settings.enable_zoom
-%}

<section class="product" data-section-id="{{ section.id }}">
  <div class="container">
    <div class="product__wrapper{% if enable_sticky %} product__wrapper--sticky{% endif %}">

      {%- comment -%} Product Media Gallery {%- endcomment -%}
      <div class="product__media-wrapper product__media-wrapper--{{ media_size }}">
        <div class="product__media-container" data-product-gallery>
          {%- if product.media.size > 0 -%}
            <div class="product__media-main" data-gallery-main>
              {%- for media in product.media -%}
                <div
                  class="product__media-item{% if media == featured_media %} is-active{% endif %}"
                  data-media-id="{{ media.id }}"
                  data-media-type="{{ media.media_type }}"
                  {% if media != featured_media %}hidden{% endif %}
                >
                  {%- case media.media_type -%}
                    {%- when 'image' -%}
                      <div class="product__media-image{% if enable_zoom %} product__media-image--zoom{% endif %}" data-zoom-container>
                        {{ media | image_url: width: 1200 | image_tag:
                          loading: 'eager',
                          widths: '400, 600, 800, 1000, 1200',
                          sizes: '(min-width: 990px) 50vw, 100vw',
                          class: 'product__image',
                          data-zoom-image: ''
                        }}
                      </div>
                    {%- when 'video' -%}
                      <div class="product__media-video">
                        {{ media | video_tag: autoplay: true, loop: true, muted: true, controls: true }}
                      </div>
                    {%- when 'external_video' -%}
                      <div class="product__media-video product__media-video--external">
                        {{ media | external_video_tag }}
                      </div>
                    {%- when 'model' -%}
                      <div class="product__media-model">
                        {{ media | model_viewer_tag }}
                      </div>
                  {%- endcase -%}
                </div>
              {%- endfor -%}
            </div>

            {%- if product.media.size > 1 -%}
              <div class="product__media-thumbs" data-gallery-thumbs>
                {%- for media in product.media -%}
                  <button
                    type="button"
                    class="product__media-thumb{% if media == featured_media %} is-active{% endif %}"
                    data-thumb-id="{{ media.id }}"
                    aria-label="{{ 'products.media_thumbnail' | t: position: forloop.index }}"
                    aria-current="{% if media == featured_media %}true{% else %}false{% endif %}"
                  >
                    {{ media | image_url: width: 150 | image_tag:
                      loading: 'lazy',
                      widths: '75, 100, 150',
                      class: 'product__thumb-image'
                    }}
                  </button>
                {%- endfor -%}
              </div>
            {%- endif -%}
          {%- else -%}
            <div class="product__media-placeholder">
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {%- endif -%}
        </div>
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div class="product__info-wrapper">
        <div class="product__info" data-product-info>
          {%- if section.settings.show_vendor and product.vendor -%}
            <p class="product__vendor">{{ product.vendor }}</p>
          {%- endif -%}

          <h1 class="product__title">{{ product.title }}</h1>

          <div class="product__price" data-product-price>
            {%- if current_variant.compare_at_price > current_variant.price -%}
              <span class="product__price-sale">{{ current_variant.price | money }}</span>
              <s class="product__price-compare">{{ current_variant.compare_at_price | money }}</s>
              <span class="product__price-badge">{{ 'products.sale' | t }}</span>
            {%- else -%}
              <span class="product__price-regular">{{ current_variant.price | money }}</span>
            {%- endif -%}
          </div>

          {%- if section.settings.show_sku and current_variant.sku -%}
            <p class="product__sku" data-product-sku>
              {{ 'products.sku' | t }}: {{ current_variant.sku }}
            </p>
          {%- endif -%}

          {%- form 'product', product, id: 'ProductForm', class: 'product__form', data-product-form: '' -%}
            <input type="hidden" name="id" value="{{ current_variant.id }}" data-variant-id>

            {%- unless product.has_only_default_variant -%}
              <div class="product__variants" data-product-variants>
                {%- for option in product.options_with_values -%}
                  <div class="product__option" data-option-index="{{ forloop.index0 }}">
                    <label class="product__option-label">
                      {{ option.name }}
                      <span class="product__option-value" data-option-value>{{ option.selected_value }}</span>
                    </label>

                    {%- if option.name == 'Color' or option.name == 'Boja' -%}
                      <div class="product__option-swatches">
                        {%- for value in option.values -%}
                          <label class="product__swatch">
                            <input
                              type="radio"
                              name="option{{ forloop.parentloop.index }}"
                              value="{{ value }}"
                              {% if value == option.selected_value %}checked{% endif %}
                              class="product__swatch-input"
                              data-option-input
                            >
                            <span
                              class="product__swatch-color"
                              style="background-color: {{ value | handleize }};"
                              title="{{ value }}"
                            ></span>
                          </label>
                        {%- endfor -%}
                      </div>
                    {%- else -%}
                      <div class="product__option-buttons">
                        {%- for value in option.values -%}
                          {%- liquid
                            assign variant_available = true
                            if product.options.size == 1
                              for variant in product.variants
                                if variant.option1 == value and variant.available == false
                                  assign variant_available = false
                                endif
                              endfor
                            endif
                          -%}
                          <label class="product__option-button{% unless variant_available %} product__option-button--unavailable{% endunless %}">
                            <input
                              type="radio"
                              name="option{{ forloop.parentloop.index }}"
                              value="{{ value }}"
                              {% if value == option.selected_value %}checked{% endif %}
                              {% unless variant_available %}disabled{% endunless %}
                              class="product__option-input"
                              data-option-input
                            >
                            <span class="product__option-text">{{ value }}</span>
                          </label>
                        {%- endfor -%}
                      </div>
                    {%- endif -%}
                  </div>
                {%- endfor -%}
              </div>
            {%- endunless -%}

            <div class="product__quantity">
              <label class="product__quantity-label" for="Quantity-{{ section.id }}">
                {{ 'products.quantity' | t }}
              </label>
              <div class="product__quantity-selector">
                <button
                  type="button"
                  class="product__quantity-btn"
                  data-quantity-minus
                  aria-label="{{ 'accessibility.decrease_quantity' | t }}"
                >
                  <span aria-hidden="true">âˆ’</span>
                </button>
                <input
                  type="number"
                  id="Quantity-{{ section.id }}"
                  name="quantity"
                  value="1"
                  min="1"
                  class="product__quantity-input"
                  data-quantity-input
                >
                <button
                  type="button"
                  class="product__quantity-btn"
                  data-quantity-plus
                  aria-label="{{ 'accessibility.increase_quantity' | t }}"
                >
                  <span aria-hidden="true">+</span>
                </button>
              </div>
            </div>

            <div class="product__buttons">
              <button
                type="submit"
                name="add"
                class="product__add-btn btn btn--primary btn--full"
                {% unless current_variant.available %}disabled{% endunless %}
                data-add-to-cart
              >
                {%- if current_variant.available -%}
                  {{ 'products.add_to_cart' | t }}
                {%- else -%}
                  {{ 'products.sold_out' | t }}
                {%- endif -%}
              </button>

              {%- if section.settings.show_buy_now -%}
                {{ form | payment_button }}
              {%- endif -%}
            </div>
          {%- endform -%}

          {%- if product.description != blank -%}
            <div class="product__accordion">
              <details class="product__accordion-item" open>
                <summary class="product__accordion-header">
                  <span class="product__accordion-title">{{ 'products.description' | t }}</span>
                  {% render 'icon-chevron' %}
                </summary>
                <div class="product__accordion-content">
                  <div class="product__description rte">
                    {{ product.description }}
                  </div>
                </div>
              </details>

              {%- for block in section.blocks -%}
                {%- case block.type -%}
                  {%- when 'collapsible_tab' -%}
                    <details class="product__accordion-item" {{ block.shopify_attributes }}>
                      <summary class="product__accordion-header">
                        <span class="product__accordion-title">{{ block.settings.heading }}</span>
                        {% render 'icon-chevron' %}
                      </summary>
                      <div class="product__accordion-content">
                        <div class="rte">
                          {{ block.settings.content }}
                        </div>
                      </div>
                    </details>
                {%- endcase -%}
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
</section>

<script type="application/json" data-product-json>
  {{ product | json }}
</script>

{%- comment -%} JSON-LD Structured Data for Google {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "description": {{ product.description | strip_html | truncate: 5000 | json }},
  "url": "{{ shop.url }}{{ product.url }}",
  "sku": {{ current_variant.sku | default: product.id | json }},
  {%- if product.featured_image -%}
  "image": [
    "https:{{ product.featured_image | image_url: width: 1200 }}"
    {%- for image in product.images offset: 1 limit: 4 -%}
    ,"https:{{ image | image_url: width: 1200 }}"
    {%- endfor -%}
  ],
  {%- endif -%}
  {%- if product.vendor != blank -%}
  "brand": {
    "@type": "Brand",
    "name": {{ product.vendor | json }}
  },
  {%- endif -%}
  "offers": {
    "@type": "Offer",
    "url": "{{ shop.url }}{{ product.url }}",
    "priceCurrency": "{{ cart.currency.iso_code }}",
    "price": "{{ current_variant.price | divided_by: 100.0 }}",
    {%- if current_variant.compare_at_price > current_variant.price -%}
    "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
    {%- endif -%}
    "availability": "https://schema.org/{% if current_variant.available %}InStock{% else %}OutOfStock{% endif %}",
    "itemCondition": "https://schema.org/NewCondition",
    "seller": {
      "@type": "Organization",
      "name": {{ shop.name | json }}
    }
  }
}
</script>

{%- comment -%} Breadcrumb Schema {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": {{ 'general.home' | t | json }},
      "item": "{{ shop.url }}"
    }
    {%- if product.collections.size > 0 -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ product.collections.first.title | json }},
      "item": "{{ shop.url }}{{ product.collections.first.url }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ product.title | json }},
      "item": "{{ shop.url }}{{ product.url }}"
    }
    {%- else -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": {{ product.title | json }},
      "item": "{{ shop.url }}{{ product.url }}"
    }
    {%- endif -%}
  ]
}
</script>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section-main-product",
  "blocks": [
    {
      "type": "collapsible_tab",
      "name": "Collapsible tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Shipping & Returns"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "select",
      "id": "media_size",
      "label": "Media size",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ],
      "default": "large"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "label": "Enable sticky product info",
      "default": true,
      "info": "Product info stays fixed while scrolling through images"
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "Enable image zoom on hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Product info"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_sku",
      "label": "Show SKU",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_buy_now",
      "label": "Show dynamic checkout button",
      "default": true,
      "info": "Shown when available. Learn more about dynamic checkout buttons."
    }
  ]
}
{% endschema %}
